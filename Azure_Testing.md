Azure Security Testing 
=============================================================================

## Security Threat Modelling for Azure. Useful as a guide and reference.

Example:
WCF: Set Message security Protection level to EncryptAndSign

https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/security/azure-security-threat-modeling-tool-communication-security.md#message-protection


## Does the application that interacts with Azure using ADFS or SSO implmentation?

https://coding.abel.nu/2017/12/using-adfs-with-azure-api-management/
https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-protect-backend-with-aad


## Application Token level 

SAS token vs Credentials consideration

### Things to consider 

A SAS gives you granular control over the type of access you grant to clients who have the SAS, including:

The interval over which the SAS is valid, including the start time and the expiry time.
The permissions granted by the SAS. For example, a SAS for a blob might grant read and write permissions to that blob, but not delete permissions.
An optional IP address or range of IP addresses from which Azure Storage will accept the SAS. For example, you might specify a range of IP addresses belonging to your organization.
The protocol over which Azure Storage will accept the SAS. You can use this optional parameter to restrict access to clients using HTTPS.

https://docs.microsoft.com/en-us/azure/storage/common/storage-dotnet-shared-access-signature-part-1


## Review of HTTPs and TLS implementation 

SSLScan and SSLyze to review on HTTPs 

REST Encryption should also be looked at if the application uses REST to communicate with Azure 

https://docs.microsoft.com/en-us/azure/storage/common/storage-security-guide#encryption-in-transit


## Audit using Storage Analytics 

Does the application uses Storage analytics to perform audit ?
Monitor of keys and request 


https://docs.microsoft.com/en-us/azure/storage/common/storage-security-guide#storage-analytics


## Is the application uses encryption for storage

SSE is managed by Azure Storage. SSE does not provide for the security of the data in transit, but it does encrypt the data as it is written to Azure Storage. SSE does not affect Azure Storage performance.

You can encrypt any kind of data of the storage account using SSE (block blobs, append blobs, page blobs, table data, queue data, and files).

https://docs.microsoft.com/en-us/azure/storage/common/storage-security-guide#storage-analytics


## CORS Security

Azure Storage allows you to enable CORS â€“ Cross Origin Resource Sharing. For each storage account, you can specify domains that can access the resources in that storage account. For example, in our case outlined above, we can enable CORS on the fabrikam.blob.core.windows.net storage account and configure it to allow access to contoso.com. Then the web application contoso.com can directly access the resources in fabrikam.blob.core.windows.net.

One thing to note is that CORS allows access, but it does not provide authentication, which is required for all non-public access of storage resources. This means you can only access blobs if they are public or you include a Shared Access Signature giving you the appropriate permission. Tables, queues, and files have no public access, and require a SAS.

https://portswigger.net/blog/exploiting-cors-misconfigurations-for-bitcoins-and-bounties
https://docs.microsoft.com/en-us/azure/storage/storage-cors-support



## Azure for Python

https://docs.microsoft.com/en-us/python/azure/?view=azure-python


## Creating Blob for Azure upload testing 

https://docs.microsoft.com/en-us/azure/storage/blobs/storage-quickstart-blobs-python

